{% extends '../base.html' %}

{% block content %}

<div class="container">
    <h1>Upload files to Server</h1>

    <input id="fileupload" type="file" />
    <button onclick="uploadFile()">Upload File</button>

    <p id="uploadfilelogs"></p>

    <script type="text/javascript">

        const url = getCurrentURL()
        console.log(url)

        function getCookie(name) {
            let cookieValue = null;

            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();

                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));

                        break;
                    }
                }
            }

            return cookieValue;
        }

        const csrftoken = getCookie('csrftoken');


        async function postData(url, data) {
            const response = await fetch(url, data);
            return response.json();
        }

        function getCurrentURL() {
            return window.location.href
        }

        async function uploadFile() {
            let formData = new FormData();
            formData.append("upload_file", fileupload.files[0]);
            data = {
                credentials: 'include',
                method: "POST",
                mode: "same-origin",
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                body: formData
            }

            postData(url, data)
                .then((resp) => {
                    document.getElementById("uploadfilelogs").body = "file saved at: " + resp.message;
                    console.log(resp);
                })
        }
    </script>
</div>

{% endblock %}